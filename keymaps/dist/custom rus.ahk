; Generated by kalamine on 2025-10-20

#NoEnv
#Persistent
#InstallKeybdHook
#SingleInstance,       force
#MaxThreadsBuffer
#MaxThreadsPerHotKey   3
#MaxHotkeysPerInterval 300
#MaxThreads            20

SendMode Event ; either Event or Input
SetKeyDelay,   -1
SetBatchLines, -1
Process, Priority, , R
SetWorkingDir, %A_ScriptDir%
StringCaseSense, On


;-------------------------------------------------------------------------------
; On/Off Switch
;-------------------------------------------------------------------------------

global Active := True

HideTrayTip() {
  TrayTip  ; Attempt to hide it the normal way.
  if SubStr(A_OSVersion,1,3) = "10." {
    Menu Tray, NoIcon
    Sleep 200  ; It may be necessary to adjust this sleep.
    Menu Tray, Icon
  }
}

ShowTrayTip() {
  title := "Custom RUS"
  text := Active ? "ON" : "OFF"
  HideTrayTip()
  TrayTip, %title% , %text%, 1, 0x31
  SetTimer, HideTrayTip, -1500
}

RAlt & Alt::
Alt & RAlt::
  global Active
  Active := !Active
  ShowTrayTip()
  return

#If Active
SetTimer, ShowTrayTip, -1000  ; not working


;-------------------------------------------------------------------------------
; DeadKey Helpers
;-------------------------------------------------------------------------------

global DeadKey := ""

; Check CapsLock status, upper the char if needed and send the char
SendChar(char) {
  if % GetKeyState("CapsLock", "T") {
    if (StrLen(char) == 6) {
      ; we have something in the form of `U+NNNN `
      ; Change it to 0xNNNN so it can be passed to `Chr` function
      char := Chr("0x" SubStr(char, 3, 4))
    }
    StringUpper, char, char
  }
  Send, {%char%}
}

DoTerm(base:="") {
  global DeadKey

  term := SubStr(DeadKey, 2, 1)

  Send, {%term%}
  SendChar(base)
  DeadKey := ""
}

DoAction(action:="") {
  global DeadKey

  if (action == "U+0020") {
    Send, {SC39}
    DeadKey := ""
  }
  else if (StrLen(action) != 2) {
    SendChar(action)
    DeadKey := ""
  }
  else if (action == DeadKey) {
    DoTerm(SubStr(DeadKey, 2, 1))
  }
  else {
    DeadKey := action
  }
}

SendKey(base, deadkeymap) {
  if (!DeadKey) {
    DoAction(base)
  }
  else if (deadkeymap.HasKey(DeadKey)) {
    DoAction(deadkeymap[DeadKey])
  }
  else {
    DoTerm(base)
  }
}


;-------------------------------------------------------------------------------
; Base
;-------------------------------------------------------------------------------

;  Digits

 SC02::SendKey("U+0031", {}) ; 1
+SC02::SendKey("U+0021", {}) ; !

 SC03::SendKey("U+0032", {}) ; 2
+SC03::SendKey("U+0040", {}) ; @

 SC04::SendKey("U+0033", {}) ; 3
+SC04::SendKey("U+0023", {}) ; #

 SC05::SendKey("U+0034", {}) ; 4
+SC05::SendKey("U+0024", {}) ; $

 SC06::SendKey("U+0035", {}) ; 5
+SC06::SendKey("U+0025", {}) ; %

 SC07::SendKey("U+0036", {}) ; 6
+SC07::SendKey("U+005e", {}) ; ^

 SC08::SendKey("U+0037", {}) ; 7
+SC08::SendKey("U+0026", {}) ; &

 SC09::SendKey("U+0038", {}) ; 8
+SC09::SendKey("U+002a", {}) ; *

 SC0a::SendKey("U+0039", {}) ; 9
+SC0a::SendKey("U+0028", {}) ; (

 SC0b::SendKey("U+0030", {}) ; 0
+SC0b::SendKey("U+0029", {}) ; )

;  Letters, first row

 SC10::SendKey("U+0439", {}) ; й
+SC10::SendKey("U+0419", {}) ; Й

 SC11::SendKey("U+0446", {}) ; ц
+SC11::SendKey("U+0426", {}) ; Ц

 SC12::SendKey("U+0443", {}) ; у
+SC12::SendKey("U+0423", {}) ; У

 SC13::SendKey("U+043a", {}) ; к
+SC13::SendKey("U+041a", {}) ; К

 SC14::SendKey("U+0435", {}) ; е
+SC14::SendKey("U+0415", {}) ; Е

 SC15::SendKey("U+043d", {}) ; н
+SC15::SendKey("U+041d", {}) ; Н

 SC16::SendKey("U+0433", {}) ; г
+SC16::SendKey("U+0413", {}) ; Г

 SC17::SendKey("U+0448", {}) ; ш
+SC17::SendKey("U+0428", {}) ; Ш

 SC18::SendKey("U+0449", {}) ; щ
+SC18::SendKey("U+0429", {}) ; Щ

 SC19::SendKey("U+0437", {}) ; з
+SC19::SendKey("U+0417", {}) ; З

;  Letters, second row

 SC1e::SendKey("U+0444", {}) ; ф
+SC1e::SendKey("U+0424", {}) ; Ф

 SC1f::SendKey("U+044b", {}) ; ы
+SC1f::SendKey("U+042b", {}) ; Ы

 SC20::SendKey("U+0432", {}) ; в
+SC20::SendKey("U+0412", {}) ; В

 SC21::SendKey("U+0430", {}) ; а
+SC21::SendKey("U+0410", {}) ; А

 SC22::SendKey("U+043f", {}) ; п
+SC22::SendKey("U+041f", {}) ; П

 SC23::SendKey("U+0440", {}) ; р
+SC23::SendKey("U+0420", {}) ; Р

 SC24::SendKey("U+043e", {}) ; о
+SC24::SendKey("U+041e", {}) ; О

 SC25::SendKey("U+043b", {}) ; л
+SC25::SendKey("U+041b", {}) ; Л

 SC26::SendKey("U+0434", {}) ; д
+SC26::SendKey("U+0414", {}) ; Д

 SC27::SendKey("U+0436", {}) ; ж
+SC27::SendKey("U+0416", {}) ; Ж

;  Letters, third row

 SC2c::SendKey("U+044f", {}) ; я
+SC2c::SendKey("U+042f", {}) ; Я

 SC2d::SendKey("U+0447", {}) ; ч
+SC2d::SendKey("U+0427", {}) ; Ч

 SC2e::SendKey("U+0441", {}) ; с
+SC2e::SendKey("U+0421", {}) ; С

 SC2f::SendKey("U+043c", {}) ; м
+SC2f::SendKey("U+041c", {}) ; М

 SC30::SendKey("U+0438", {}) ; и
+SC30::SendKey("U+0418", {}) ; И

 SC31::SendKey("U+0442", {}) ; т
+SC31::SendKey("U+0422", {}) ; Т

 SC32::SendKey("U+044c", {}) ; ь
+SC32::SendKey("U+042c", {}) ; Ь

 SC33::SendKey("U+0431", {}) ; б
+SC33::SendKey("U+0411", {}) ; Б

 SC34::SendKey("U+044e", {}) ; ю
+SC34::SendKey("U+042e", {}) ; Ю

 SC35::SendKey("U+002e", {}) ; .
+SC35::SendKey("U+002c", {}) ; ,

;  Pinky keys

 SC0c::SendKey("U+002d", {}) ; -
+SC0c::SendKey("U+005f", {}) ; _

 SC0d::SendKey("U+003d", {}) ; =
+SC0d::SendKey("U+002b", {}) ; +

 SC1a::SendKey("U+0445", {}) ; х
+SC1a::SendKey("U+0425", {}) ; Х

 SC1b::SendKey("U+044a", {}) ; ъ
+SC1b::SendKey("U+042a", {}) ; Ъ

 SC28::SendKey("U+044d", {}) ; э
+SC28::SendKey("U+042d", {}) ; Э

 SC29::SendKey("U+0060", {}) ; `
+SC29::SendKey("U+007e", {}) ; ~

 SC2b::SendKey("U+005c", {}) ; \
+SC2b::SendKey("U+007c", {}) ; |

;  Space bar

 SC39::SendKey("U+0020", {}) ;  
+SC39::SendKey("U+0020", {}) ;  


;-------------------------------------------------------------------------------
; AltGr
;-------------------------------------------------------------------------------

;  Digits

 <^>!SC02::SendKey("U+0021", {}) ; !

 <^>!SC03::SendKey("U+0040", {}) ; @
<^>!+SC03::SendKey("U+2116", {}) ; №

 <^>!SC04::SendKey("U+0023", {}) ; #

 <^>!SC05::SendKey("U+0024", {}) ; $

 <^>!SC06::SendKey("U+0025", {}) ; %

 <^>!SC07::SendKey("U+005e", {}) ; ^

 <^>!SC08::SendKey("U+0026", {}) ; &

 <^>!SC09::SendKey("U+002a", {}) ; *

;  Letters, first row

 <^>!SC11::SendKey("U+003c", {}) ; <
<^>!+SC11::SendKey("U+00ab", {}) ; «

 <^>!SC12::SendKey("U+002b", {}) ; +

 <^>!SC13::SendKey("U+003e", {}) ; >
<^>!+SC13::SendKey("U+00bb", {}) ; »

 <^>!SC14::SendKey("U+0060", {}) ; `

 <^>!SC15::SendKey("U+0027", {}) ; '

 <^>!SC16::SendKey("U+007b", {}) ; {

 <^>!SC17::SendKey("U+005f", {}) ; _

 <^>!SC18::SendKey("U+007d", {}) ; }

;  Letters, second row

 <^>!SC1f::SendKey("U+005b", {}) ; [

 <^>!SC20::SendKey("U+003d", {}) ; =

 <^>!SC21::SendKey("U+005d", {}) ; ]

 <^>!SC22::SendKey("U+007e", {}) ; ~

 <^>!SC23::SendKey("U+0022", {}) ; "

 <^>!SC24::SendKey("U+0028", {}) ; (

 <^>!SC25::SendKey("U+002d", {}) ; -

 <^>!SC26::SendKey("U+0029", {}) ; )

;  Letters, third row

 <^>!SC2d::SendKey("U+005c", {}) ; \

 <^>!SC2e::SendKey("U+007c", {}) ; |
<^>!+SC2e::SendKey("U+00a6", {}) ; ¦

 <^>!SC2f::SendKey("U+002f", {}) ; /

 <^>!SC31::SendKey("U+003b", {}) ; ;

 <^>!SC32::SendKey("U+003a", {}) ; :

 <^>!SC33::SendKey("U+002c", {}) ; ,

 <^>!SC34::SendKey("U+002e", {}) ; .

 <^>!SC35::SendKey("U+003f", {}) ; ?

;  Pinky keys

;  Space bar

 <^>!SC39::SendKey("U+0020", {}) ;  
<^>!+SC39::SendKey("U+0020", {}) ;  

; Special Keys

$<^>!Esc::       Send {SC01}
$<^>!End::       Send {SC4f}
$<^>!Home::      Send {SC47}
$<^>!Delete::    Send {SC53}
$<^>!Backspace:: Send {SC0e}


;-------------------------------------------------------------------------------
; Ctrl
;-------------------------------------------------------------------------------

;  Digits

;  Letters, first row

;  Letters, second row

;  Letters, third row

;  Pinky keys

;  Space bar

